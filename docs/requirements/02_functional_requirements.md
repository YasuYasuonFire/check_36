# 機能要件（シンプル入力版）

- 対象範囲
  - 現在の月を前提に、上限到達リスクを評価
  - 対象とする指標は次の2つ（簡易判定）
    - 月45時間（時間外のみ）
    - 80時間（休日労働を含む、簡易的に単月評価として比較）

- 入力（最小）
  - totalWorkHoursToDate: **前日までの**総労働時間 累計（h）【必須】
  - holidayWorkHoursToDate: **前日までの**休日労働 累計（h）【必須】
  - workingDaysElapsed: **前日までに**働いた日数【必須】
  - workingDaysRemaining: **今日を含む**残りの稼働日数【必須】
  - currentDate: 評価基準日（YYYY-MM-DD、未指定ならシステム日付）【任意】
  
  ※ 業務時間中に使用することを想定し、入力は「昨日まで」の確定値とする

- 出力（概要）
  - evaluation45: 45h上限に対する評価
    - 昨日までの総労働時間
    - 月末予測の総労働時間
    - 月末予測の時間外労働
    - 45hまでの残り（負=超過見込み）
    - リスクレベル
    - リカバリー提案（複数パターン）
  - evaluation80: 80h基準（休日含む）に対する評価
    - 同様の構成
  
  ※ フレックス制度対応：「現在の時間外」は算出不可のため、予測ベースで評価

- 予測ロジック
  - **月の法定労働時間の算出**
    - 月の暦日数 = currentDate から取得（例: 2025-04 → 30日）
    - 月の法定労働時間 = (暦日数 ÷ 7) × 40時間
      - 例: 30日の月 → 30 ÷ 7 × 40 ≈ 171.4時間
  
  - **月末予測（総労働時間）**
    - 1日あたり平均労働時間 = totalWorkHoursToDate ÷ workingDaysElapsed
    - 予測総労働時間 = totalWorkHoursToDate + (workingDaysRemaining × 1日平均労働時間)
    
    ※ workingDaysElapsed = 0 の場合はゼロ割回避（デフォルト8h/日を使用）
  
  - **月末予測（時間外労働）**
    - 予測時間外労働 = 予測総労働時間 - 月の法定労働時間
    - 予測時間外+休日 = 予測時間外労働 + holidayWorkHoursToDate
    
    ※ フレックス制度では「現在の時間外」は算出不可（1日の法定時間が固定でないため）
    ※ 予測ベースでのみ評価する

- 判定
  - 45h: projectedOT と 45 を比較
  - 80h: projectedALL と 80 を比較（簡易単月評価として）
  - リスクレベル: OK / WARN / LIMIT（例: WARN=上限の80%以上、LIMIT=上限以上）

- リカバリー算出（複数パターン提示）
  - 残稼働日数 R = workingDaysRemaining
  - 45h向け
    - 上限までの残余 rem45 = max(0, 45 - 予測時間外労働)
    - 超過見込み excess45 = max(0, 予測時間外労働 - 45)
    - 複数パターン生成（年休0日、1日、2日、3日...の各ケース）
      - 各パターンで「年休N日 + 残り稼働日の1日あたり上限」を算出
      - パターン数: 最大5個（0日〜上限到達に必要な日数まで）
    - 各パターン計算式:
      - 実働日数 = R - N（年休日数）
      - 年休N日取得時の削減総労働時間 = N × 8時間（年休1日 = -8時間）
      - 調整後予測総労働時間 = 予測総労働時間 - (N × 8時間)
      - 調整後予測時間外 = 調整後予測総労働時間 - 月の法定労働時間
      - 上限達成に必要な総労働時間 = 月の法定労働時間 + 45
      - 残り期間で可能な総労働時間 = 上限達成総労働時間 - 現在の総労働時間
      - **1日あたり上限総労働時間 = 残り期間で可能な総労働時間 / 実働日数**
      - description: "年休N日取得：残りX日間、1日あたりY時間以内"
  - 80h向け（休日含む）
    - 上限までの残余 rem80 = max(0, 80 - 予測時間外+休日)
    - 超過見込み excess80 = max(0, 予測時間外+休日 - 80)
    - 同様に複数パターン生成

- 注意/前提
  - 80時間は本来「2〜6か月平均（休日含む）」の基準だが、当面は単月の簡易比較として扱う
  - 年休1日取得で削減できる時間は「1日平均労働時間」として計算
  - 月の法定労働時間は暦日数に基づき自動計算
  - 月末予測は「昨日までの平均ペース」に基づく（実態を反映）
  - 入力は「前日までの確定値」を想定（業務時間中の使用を考慮）
  - 制度差（裁量・フレックス等）は未考慮（将来拡張）
